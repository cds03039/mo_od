<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="kr.co.mood.Payment.DAO.AdminPaymentDAO">

    <select id="getCategoryChart1" resultType="kr.co.mood.Payment.VO.AdminPaymentVO">
         SELECT pro_serialnumber as 'serialNumber', 
         		SUM(pro_paycount) as 'payCount' 
         	FROM product 
         	where pro_paycount > 0 
         	group by pro_serialnumber 
         	order by SUM(pro_paycount) desc
         	limit 0, 5
    </select>
    
    <select id="getCategoryChart2" resultType="kr.co.mood.Payment.VO.AdminPaymentVO">
         select pro_serialnumber as 'serialNumber', 
         		pro_bucketcount as 'bucketCount' 
         	from product 
         	where pro_bucketcount > 0
         	order by pro_bucketcount desc 
         	limit 0, 5
    </select>
    
    <select id="getCategoryChart3" resultType="kr.co.mood.Payment.VO.AdminPaymentVO">
         <![CDATA[
         SELECT CASE DAYOFWEEK(approved_at) 
         		WHEN 1 THEN '월요일' 
         		WHEN 2 THEN '화요일' 
         		WHEN 3 THEN '수요일' 
         		WHEN 4 THEN '목요일' 
         		WHEN 5 THEN '금요일' 
         		WHEN 6 THEN '토요일' 
         		WHEN 7 THEN '일요일' 
         		ELSE '유효한 날짜가 아닙니다.' END as week, 
         	sum(amount) as sales 
         	from payment 
         	where Success = 'A'
					and approved_at like concat(#{year}, '%')
         	group by DAYOFWEEK(approved_at)
         	order by DAYOFWEEK(approved_at)
         	]]>
    </select>
    
    <select id="getCategoryChart4" resultType="kr.co.mood.Payment.VO.AdminPaymentVO">
		<![CDATA[
		select member.gender as gender, product.pro_categoryserial as 'categorySerial', 
				sum(orderProduct.count) as 'productCount', 
				CASE DAYOFWEEK(payment.approved_at) 
         		WHEN 1 THEN '월요일' 
         		WHEN 2 THEN '화요일' 
         		WHEN 3 THEN '수요일' 
         		WHEN 4 THEN '목요일' 
         		WHEN 5 THEN '금요일' 
         		WHEN 6 THEN '토요일' 
         		WHEN 7 THEN '일요일' 
         		ELSE '유효한 날짜가 아닙니다.' END as week
			from payment 
			inner join moodjoin as member 
				on payment.userId = member.no
			inner join orderProduct
				on payment.orderid = orderProduct.orderId
			inner join product
				on orderProduct.pro_number = product.pro_number
			where payment.Success = 'A'
				and payment.approved_at like concat(#{year}, '%')
			group by product.pro_categoryserial
			order by DAYOFWEEK(payment.approved_at) desc
			limit 0, 5
			]]>
    </select>
    
</mapper>


